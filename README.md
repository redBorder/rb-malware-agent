[![Coverage Status](https://coveralls.io/repos/github/redBorder/rb-malware-agent/badge.svg?branch=master)](https://coveralls.io/github/redBorder/rb-malware-agent?branch=master)
[![Go Report Card](https://goreportcard.com/badge/github.com/redBorder/rb-malware-agent)](https://goreportcard.com/report/github.com/redBorder/rb-malware-agent)
[![GoDoc](https://godoc.org/github.com/redBorder/rb-malware-agent?status.svg)](https://godoc.org/github.com/redBorder/rb-malware-agent)

# rb-malware-agent
#
![Alt Text](https://i.imgur.com/WrtuYk6.jpg)

## Warning

This service is in development stage, and we constantly make changes to it. Therefore, bugs may occur. The master branch should be compatible with the latest redBorder reputation server and be the most stable version to use on production.

Currently, the SDK builds this service using Go version go1.11.13 linux/amd64 with Glide version 0.13.0-dev.

>⚠️ :  **You may encounter some weird issues when using different Go versions with the GCC Compiler when building this...**

## Overview

This is a tool for query and obtain data from the redBorder's Malware API. There are two types of data that can be obtained:

- IPs scores
- File hashes score

It stores the data on two separated files, one for hashes (files analyzed) and another for IPs that have a score higher than a
number that you can specify. After the data is gathered from the API, the app can notify snort via snortcontrol unix socket.


## Installing Glide and building project

1. Glide is now discontinued, to install it correctly download bin from here -> https://github.com/Masterminds/glide/releases/tag/v0.13.0

2. Make sure you have GOPATH set correctly.

3. Copy-paste the `glide` bin in $GOPATH/bin

4. Check version running `glide -v`


And then:

1. Clone this repo and cd to the project

    ```bash
    git clone https://github.com/redBorder/rb-malware-agent.git && cd rb-malware-agent
    ```
2. Install dependencies and compile

    ```bash
    make
    ```
3. Install on desired directory

    ```bash
    prefix=/opt/rb make install
    ```

4. 
   If you want to rebuild this project because you made some changes in the code-base ->
   ```bash
     make clean
     make
   ```

## Usage

Usage of redborder-malware-agent:

```
--config string
    Config file
--debug
    Print debug info
```

## Configuration

This is an example config file:

- **url** (string): address of the API to connect.
- **min_score** (integer): Hashes and IPs with score greather than this value goes to the blacklist and
those which score lower than this value goes to the whitelist.
- **ip_blacklist**, **ip_whitelist**, **hash_blacklist**, **hash_whitelist** (string): Stores information got from the API.
- **interval** (integer): time in seconds between calls to the API.
- **snort_socket_path**: Path to the `/instance-i/SNORT.socket` file. The app will iterate through folders where `i` is the index of the instance.
- **snort_socket_timeout**: Max time in seconds to wait for snort response after the notification is sent.

### Example

Note:

In redBorder-IPS-sensor, you need to load the lists using prexif "redBorder-file" with (.blf) or (.wlf) extension (whitelist/blacklist),
if you dont use that names without that extension, it will cause to not load the lists when snort (restart/reload/start) or when reloading
via unix socket causing a segmentation fault...

https://snort-org-site.s3.amazonaws.com/production/document_files/files/000/000/249/original/snort_manual.pdf -> page 125

```yaml
url: "http://10.0.161.177:7777/reputation/v1/malware"
interval: 0
snort_socket_timeout: 5
instances: [{
  min_score: 1,
  ip_blacklist: "iplists/redBorder-file-malware-agent.blf",
  ip_whitelist: "iplists/redBorder-file-malware-agent.wlf",
  hash_blacklist: "files/black_1.list",
  hash_whitelist: "files/seen_1.list",
  snort_socket_path: "/etc/snort/0/cs/0",
  url_blacklist: /etc/snort/0/url/urls.rules,
  snort_instance_path: "/etc/snort/0"
  },{
  min_score: 5,
  ip_blacklist: "iplists/redBorder-file-malware-agent.blf",
  ip_whitelist: "iplists/redBorder-file-malware-agent.wlf",
  hash_blacklist: "files/black_2.list",
  hash_whitelist: "files/seen_2.list",
  snort_socket_path: "/etc/snort/0/cs/1",
  url_blacklist: /etc/snort/1/url/urls.rules,
  snort_instance_path: "/etc/snort/1"
}]
